<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴? | Joeytat's Dev Log</title>
<meta name=keywords content="iOS"><meta name=description content="昨天在 Twitter 上看到 TualatriX 说[把私有库都通过 Cocoapods 编译成静态库之后很爽](https://twitter.com/tualatrix/status/1077166131956264960), 就有点好奇到底是爽在哪里."><meta name=author content><link rel=canonical href=http://localhost:1313/posts/cocoapods-1/><meta name=google-site-verification content="G-83QEEKFELL"><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/cocoapods-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-83QEEKFELL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-83QEEKFELL")}</script><meta property="og:url" content="http://localhost:1313/posts/cocoapods-1/"><meta property="og:site_name" content="Joeytat's Dev Log"><meta property="og:title" content="为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?"><meta property="og:description" content="昨天在 Twitter 上看到 TualatriX 说[把私有库都通过 Cocoapods 编译成静态库之后很爽](https://twitter.com/tualatrix/status/1077166131956264960), 就有点好奇到底是爽在哪里."><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-27T00:00:00+00:00"><meta property="article:modified_time" content="2018-12-27T00:00:00+00:00"><meta property="article:tag" content="IOS"><meta name=twitter:card content="summary"><meta name=twitter:title content="为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?"><meta name=twitter:description content="昨天在 Twitter 上看到 TualatriX 说[把私有库都通过 Cocoapods 编译成静态库之后很爽](https://twitter.com/tualatrix/status/1077166131956264960), 就有点好奇到底是爽在哪里."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?","item":"http://localhost:1313/posts/cocoapods-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?","name":"为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?","description":"昨天在 Twitter 上看到 TualatriX 说[把私有库都通过 Cocoapods 编译成静态库之后很爽](https://twitter.com/tualatrix/status/1077166131956264960), 就有点好奇到底是爽在哪里.","keywords":["iOS"],"articleBody":"昨天在 Twitter 上看到 TualatriX 说把私有库都通过 Cocoapods 编译成静态库之后很爽, 就有点好奇到底是爽在哪里.\n于是去搜了一下, 原来是前段时间(大半年前吧…), Cocoapods 发布了 1.5 的 release note, 宣布支持 Swift 静态库编译. 并且文中提到了对于担心动态二进制文件影响应用启动速度的人来说, 这是个了不起的更新. jh 那又是为什么 App 使用静态库会比动态库有更快的启动速度呢? 又跑去搜了一下官方文档. 打开 Dynamic Library Programming Topics 开头就看到:\nThis article introduces dynamic libraries and shows how using dynamic libraries instead of static libraries reduces both the file size and initial memory footprint of the apps that use them.\n这篇文章主要介绍了动态库, 并且展示了通过使用动态库而不是静态库, 是如何缩减了应用的大小和初始内存空间的.\n┻━┻ (ヽ(`Д ́)ノ( ┻━┻ 这和说好的不一样啊?\n带着疑问我又跑去看了一下苹果的 WWDC 2016 - Optimizing App Startup Time 的视频, 这次问题终于得到了解决.\n这里的库是什么? 是可执行文件的集合. 静态库与动态库调用时机的区别在于, 静态库在应用启动的时候, 会和程序的可执行代码一起, 被加载到应用的内存空间中. 这就会导致应用启动慢, 并且内存占用大. 而动态库则是在代码真正被需要调用的时候, 才加载到内存中.\n所以才会有苹果文档中提到的「通过使用动态库而不是静态库, 是如何缩减了应用的大小和初始内存空间的」这句话.\n可这是站在系统角度来说的. 在 iOS 中, 平均每个 App 包含了 1 到 400 个动态库. 其中有很大一部分是系统级动态库. 苹果为其做了许多的优化, 比如提前计算, 提前缓存等. 这对于系统提供的动态库来说, 当然比静态库更快.\n但 App 中还包含了很多自有的动态库, 这部分动态库苹果没有办法为期提供优化. 而对于 dylib 的加载又是非常耗费资源的. 所以苹果对其的建议是最好在 6 个左右.\n然后我也把项目中的 Swift pods 编译为静态库了, 效果如下.\n// 优化前 [DYMTLInitPlatform] platform initialization successful Total pre-main time: 1.5 seconds (100.0%) dylib loading time: 968.07 milliseconds (61.1%) ...... ...... // Pods 使用静态库后 [DYMTLInitPlatform] platform initialization successful Total pre-main time: 1.1 seconds (100.0%) dylib loading time: 520.52 milliseconds (47.2%) ...... ...... 最后再总结一下.\n对于系统提供了优化的动态库来说, 一定是比静态库启动加载快且占用内存更小的. 14er 而对于 App 自有的动态库来说, 系统在加载动态库所消耗的资源要比加载静态库来得多, 所以最好限制在 6 个左右. 参考链接 Cocoapods 的静态库和动态库 WWDC 2016 - Optimizing App Startup Time Dynamic Library Programming Topics 美团外卖 iOS App冷启动治理 ","wordCount":"193","inLanguage":"en","datePublished":"2018-12-27T00:00:00Z","dateModified":"2018-12-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/cocoapods-1/"},"publisher":{"@type":"Organization","name":"Joeytat's Dev Log","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Dev Log (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Dev Log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives title=Archives><span>Archives</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">为什么 Cocoapods 1.5 支持编译静态库之后大家这么高兴?</h1><div class=post-description>昨天在 Twitter 上看到 TualatriX 说[把私有库都通过 Cocoapods 编译成静态库之后很爽](https://twitter.com/tualatrix/status/1077166131956264960), 就有点好奇到底是爽在哪里.</div><div class=post-meta><span title='2018-12-27 00:00:00 +0000 UTC'>December 27, 2018</span></div></header><div class=post-content><p>昨天在 Twitter 上看到 TualatriX 说<a href=https://twitter.com/tualatrix/status/1077166131956264960>把私有库都通过 Cocoapods 编译成静态库之后很爽</a>, 就有点好奇到底是爽在哪里.</p><p>于是去搜了一下, 原来是前段时间(大半年前吧&mldr;), Cocoapods 发布了 1.5 的 <a href=http://blog.cocoapods.org/CocoaPods-1.5.0/>release note</a>, 宣布支持 Swift 静态库编译. 并且文中提到了对于担心动态二进制文件影响应用启动速度的人来说, 这是个了不起的更新.
jh
那又是为什么 App 使用静态库会比动态库有更快的启动速度呢? 又跑去搜了一下官方文档. 打开 <a href=https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/OverviewOfDynamicLibraries.html>Dynamic Library Programming Topics</a> 开头就看到:</p><blockquote><p>This article introduces dynamic libraries and shows how using dynamic libraries instead of static libraries reduces both the file size and initial memory footprint of the apps that use them.</p></blockquote><blockquote><p>这篇文章主要介绍了动态库, 并且展示了通过<strong>使用动态库</strong>而不是静态库, 是如何<strong>缩减</strong>了应用的大小和初始内存空间的.</p></blockquote><p><img alt=黑人问号 loading=lazy src=http://ww1.rs.fanjian.net/c/ab/c8/25/53abf0c06ec808c1fe250d3565ff0d32.jpg></p><p>┻━┻ (ヽ(`Д ́)ノ( ┻━┻ 这和说好的不一样啊?</p><p>带着疑问我又跑去看了一下苹果的 <a href=https://developer.apple.com/videos/play/wwdc2016/406>WWDC 2016 - Optimizing App Startup Time</a> 的视频, 这次问题终于得到了解决.</p><p>这里的库是什么? 是可执行文件的集合. 静态库与动态库调用时机的区别在于, 静态库在应用启动的时候, 会和程序的可执行代码一起, 被加载到应用的内存空间中. 这就会导致应用启动慢, 并且内存占用大. 而动态库则是在代码真正被需要调用的时候, 才加载到内存中.</p><p>所以才会有苹果文档中提到的「通过<strong>使用动态库</strong>而不是静态库, 是如何<strong>缩减</strong>了应用的大小和初始内存空间的」这句话.</p><p>可这是站在系统角度来说的. 在 iOS 中, 平均每个 App 包含了 <a href="https://developer.apple.com/videos/play/wwdc2016-406/?time=1684">1 到 400</a> 个动态库. 其中有很大一部分是系统级动态库. 苹果为其做了许多的优化, 比如提前计算, 提前缓存等. 这对于系统提供的动态库来说, 当然比静态库更快.</p><p>但 App 中还包含了很多自有的动态库, 这部分动态库苹果没有办法为期提供优化. 而对于 dylib 的加载又是非常耗费资源的. 所以苹果对其的建议是最好在 <a href="https://developer.apple.com/videos/play/wwdc2016-406/?time=1794">6</a> 个左右.</p><p>然后我也把项目中的 Swift pods 编译为静态库了, 效果如下.</p><pre tabindex=0><code>// 优化前
[DYMTLInitPlatform] platform initialization successful
Total pre-main time: 1.5 seconds (100.0%)
         dylib loading time: 968.07 milliseconds (61.1%)
        ......
        ......
</code></pre><pre tabindex=0><code>// Pods 使用静态库后
[DYMTLInitPlatform] platform initialization successful
Total pre-main time: 1.1 seconds (100.0%)
         dylib loading time: 520.52 milliseconds (47.2%)
        ......
        ......
</code></pre><p>最后再总结一下.</p><ul><li>对于系统提供了优化的动态库来说, 一定是比静态库启动加载快且占用内存更小的. 14er</li><li>而对于 App 自有的动态库来说, 系统在加载动态库所消耗的资源要比加载静态库来得多, 所以最好限制在 6 个左右.</li></ul><h2 id=参考链接>参考链接<a hidden class=anchor aria-hidden=true href=#参考链接>#</a></h2><ul><li><a href=https://www.jianshu.com/p/3d0ae289dee0>Cocoapods 的静态库和动态库</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2016/406/?time=203">WWDC 2016 - Optimizing App Startup Time</a></li><li><a href=https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/OverviewOfDynamicLibraries.html>Dynamic Library Programming Topics</a></li><li><a href=https://tech.meituan.com/waimai_ios_optimizing_startup.html>美团外卖 iOS App冷启动治理</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/ios/>IOS</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/2018_overview/><span class=title>« Prev</span><br><span>2018</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Joeytat's Dev Log</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>